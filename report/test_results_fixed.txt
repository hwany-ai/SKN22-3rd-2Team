============================= test session starts =============================
platform win32 -- Python 3.13.9, pytest-9.0.2, pluggy-1.5.0 -- C:\Users\Playdata\miniconda3\python.exe
cachedir: .pytest_cache
metadata: {'Python': '3.13.9', 'Platform': 'Windows-11-10.0.26100-SP0', 'Packages': {'pytest': '9.0.2', 'pluggy': '1.5.0'}, 'Plugins': {'anyio': '4.12.0', 'langsmith': '0.6.4', 'asyncio': '1.3.0', 'html': '4.2.0', 'metadata': '3.1.1'}, 'JAVA_HOME': 'C:\\Program Files\\Android\\Android Studio\\jbr'}
rootdir: C:\Workspaces\SKN22-3rd-2Team
plugins: anyio-4.12.0, langsmith-0.6.4, asyncio-1.3.0, html-4.2.0, metadata-3.1.1
asyncio: mode=Mode.STRICT, debug=False, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
collecting ... collected 27 items

tests/test_hybrid_search.py::TestHybridSearchRRF::test_cross_rank_verification_top_tier PASSED [  3%]
tests/test_hybrid_search.py::TestHybridSearchRRF::test_symmetric_weighting PASSED [  7%]
tests/test_hybrid_search.py::TestHybridSearchRRF::test_asymmetric_weighting_dense_heavy PASSED [ 11%]
tests/test_hybrid_search.py::TestHybridSearchRRF::test_asymmetric_weighting_sparse_heavy PASSED [ 14%]
tests/test_hybrid_search.py::TestHybridSearchRRF::test_edge_case_empty_dense_results PASSED [ 18%]
tests/test_hybrid_search.py::TestHybridSearchRRF::test_edge_case_empty_sparse_results PASSED [ 22%]
tests/test_hybrid_search.py::TestHybridSearchRRF::test_edge_case_both_empty PASSED [ 25%]
tests/test_hybrid_search.py::TestHybridSearchRRF::test_rrf_k_constant_effect PASSED [ 29%]
tests/test_parser.py::TestClaimParserLevel1Regex::test_standard_us_format_basic FAILED [ 33%]
tests/test_parser.py::TestClaimParserLevel1Regex::test_claim_numbering FAILED [ 37%]
tests/test_parser.py::TestClaimParserLevel1Regex::test_independent_vs_dependent_detection FAILED [ 40%]
tests/test_parser.py::TestClaimParserLevel1Regex::test_rag_component_detection FAILED [ 44%]
tests/test_parser.py::TestClaimParserLevel1Regex::test_claim_text_content FAILED [ 48%]
tests/test_parser.py::TestClaimParserLevel2Structure::test_bracket_numbered_format PASSED [ 51%]
tests/test_parser.py::TestClaimParserLevel2Structure::test_korean_format_parsing PASSED [ 55%]
tests/test_parser.py::TestClaimParserLevel2Structure::test_mixed_indent_structure PASSED [ 59%]
tests/test_parser.py::TestClaimParserLevel3NLP::test_ocr_noise_handling PASSED [ 62%]
tests/test_parser.py::TestClaimParserLevel3NLP::test_nlp_disabled_graceful_fallback PASSED [ 66%]
tests/test_parser.py::TestClaimParserLevel3NLP::test_sentence_boundary_mock PASSED [ 70%]
tests/test_parser.py::TestClaimParserLevel4Minimal::test_raw_text_blob_fallback PASSED [ 74%]
tests/test_parser.py::TestClaimParserLevel4Minimal::test_empty_input_handling PASSED [ 77%]
tests/test_parser.py::TestClaimParserLevel4Minimal::test_whitespace_only_input PASSED [ 81%]
tests/test_parser.py::TestClaimParserLevel4Minimal::test_single_paragraph_fallback PASSED [ 85%]
tests/test_parser.py::TestClaimParserLevel4Minimal::test_multiple_paragraphs_fallback FAILED [ 88%]
tests/test_parser.py::TestClaimParserDataIntegrity::test_parsed_claim_dataclass_fields PASSED [ 92%]
tests/test_parser.py::TestClaimParserDataIntegrity::test_char_and_word_counts PASSED [ 96%]
tests/test_parser.py::TestClaimParserDataIntegrity::test_claims_sorted_by_number PASSED [100%]

================================== FAILURES ===================================
__________ TestClaimParserLevel1Regex.test_standard_us_format_basic ___________

self = <test_parser.TestClaimParserLevel1Regex object at 0x0000024C29F71310>
parser = <preprocessor.ClaimParser object at 0x0000024C29FD9A90>
standard_us_claims = '\n1. A method for neural network-based document retrieval comprising:\n   receiving a query from a user;\n   generati...r; and\n   a memory containing instructions that when executed cause the processor to perform the method of claim 1.\n'

    def test_standard_us_format_basic(self, parser, standard_us_claims):
        """
        Level 1 (Regex): Parse standard US claim format '1. A method...'.
    
        Expected: Should extract 4 claims with correct numbering.
        """
        claims = parser.parse_claims_text(standard_us_claims)
    
>       assert len(claims) == 4, (
            f"Expected 4 claims, got {len(claims)}: {[c.claim_number for c in claims]}"
        )
E       AssertionError: Expected 4 claims, got 1: [1]
E       assert 1 == 4
E        +  where 1 = len([ParsedClaim(claim_number=1, claim_text=', wherein the embedding is generated using a transformer model. 3. The method of claim 1, wherein the vector database uses cosine similarity. 4. A system comprising: a processor; and a memory containing instructions that when executed cause the processor to perform the method of claim', claim_type='dependent', parent_claim=1, rag_components=[], char_count=285, word_count=46)])

tests\test_parser.py:126: AssertionError
_______________ TestClaimParserLevel1Regex.test_claim_numbering _______________

self = <test_parser.TestClaimParserLevel1Regex object at 0x0000024C29F72850>
parser = <preprocessor.ClaimParser object at 0x0000024C51E95BD0>
standard_us_claims = '\n1. A method for neural network-based document retrieval comprising:\n   receiving a query from a user;\n   generati...r; and\n   a memory containing instructions that when executed cause the processor to perform the method of claim 1.\n'

    def test_claim_numbering(self, parser, standard_us_claims):
        """
        Level 1 (Regex): Verify claim numbers are correctly extracted.
        """
        claims = parser.parse_claims_text(standard_us_claims)
        claim_numbers = [c.claim_number for c in claims]
    
>       assert claim_numbers == [1, 2, 3, 4], (
            f"Expected claim numbers [1, 2, 3, 4], got {claim_numbers}"
        )
E       AssertionError: Expected claim numbers [1, 2, 3, 4], got [1]
E       assert [1] == [1, 2, 3, 4]
E         
E         Right contains 3 more items, first extra item: 2
E         
E         Full diff:
E           [
E               1,
E         -     2,...
E         
E         ...Full output truncated (3 lines hidden), use '-vv' to show

tests\test_parser.py:137: AssertionError
_____ TestClaimParserLevel1Regex.test_independent_vs_dependent_detection ______

self = <test_parser.TestClaimParserLevel1Regex object at 0x0000024C29D9A3F0>
parser = <preprocessor.ClaimParser object at 0x0000024C51E96210>
standard_us_claims = '\n1. A method for neural network-based document retrieval comprising:\n   receiving a query from a user;\n   generati...r; and\n   a memory containing instructions that when executed cause the processor to perform the method of claim 1.\n'

    def test_independent_vs_dependent_detection(self, parser, standard_us_claims):
        """
        Level 1 (Regex): Correctly identify independent and dependent claims.
    
        Claims 1 and 4 are independent (no parent reference).
        Claims 2 and 3 reference claim 1 (dependent).
        """
        claims = parser.parse_claims_text(standard_us_claims)
    
        # Claim 1 should be independent
        claim_1 = next(c for c in claims if c.claim_number == 1)
>       assert claim_1.claim_type == "independent", (
            f"Claim 1 should be independent, got: {claim_1.claim_type}"
        )
E       AssertionError: Claim 1 should be independent, got: dependent
E       assert 'dependent' == 'independent'
E         
E         - independent
E         ? --
E         + dependent

tests\test_parser.py:152: AssertionError
___________ TestClaimParserLevel1Regex.test_rag_component_detection ___________

self = <test_parser.TestClaimParserLevel1Regex object at 0x0000024C29D9B5C0>
parser = <preprocessor.ClaimParser object at 0x0000024C51E90FC0>
standard_us_claims = '\n1. A method for neural network-based document retrieval comprising:\n   receiving a query from a user;\n   generati...r; and\n   a memory containing instructions that when executed cause the processor to perform the method of claim 1.\n'

    def test_rag_component_detection(self, parser, standard_us_claims):
        """
        Level 1 (Regex): Detect RAG component keywords in claims.
    
        Note: Explicitly inject rag_keywords to ensure detection works.
        """
        # Explicitly set rag_keywords (mock config doesn't always apply)
        parser.rag_keywords = ["retrieval", "embedding", "vector", "neural", "transformer"]
    
        claims = parser.parse_claims_text(standard_us_claims)
    
        # Claim 1 should detect "retrieval", "embedding", "vector"
        claim_1 = next(c for c in claims if c.claim_number == 1)
    
>       assert "retrieval" in claim_1.rag_components, (
            f"Should detect 'retrieval' in claim 1, got: {claim_1.rag_components}"
        )
E       AssertionError: Should detect 'retrieval' in claim 1, got: ['embedding', 'vector', 'transformer']
E       assert 'retrieval' in ['embedding', 'vector', 'transformer']
E        +  where ['embedding', 'vector', 'transformer'] = ParsedClaim(claim_number=1, claim_text=', wherein the embedding is generated using a transformer model. 3. The method of claim 1, wherein the vector database uses cosine similarity. 4. A system comprising: a processor; and a memory containing instructions that when executed cause the processor to perform the method of claim', claim_type='dependent', parent_claim=1, rag_components=['embedding', 'vector', 'transformer'], char_count=285, word_count=46).rag_components

tests\test_parser.py:182: AssertionError
_____________ TestClaimParserLevel1Regex.test_claim_text_content ______________

self = <test_parser.TestClaimParserLevel1Regex object at 0x0000024C29F47650>
parser = <preprocessor.ClaimParser object at 0x0000024C51E916E0>
standard_us_claims = '\n1. A method for neural network-based document retrieval comprising:\n   receiving a query from a user;\n   generati...r; and\n   a memory containing instructions that when executed cause the processor to perform the method of claim 1.\n'

    def test_claim_text_content(self, parser, standard_us_claims):
        """
        Level 1 (Regex): Verify claim text is extracted correctly.
        """
        claims = parser.parse_claims_text(standard_us_claims)
        claim_1 = next(c for c in claims if c.claim_number == 1)
    
>       assert "neural network" in claim_1.claim_text.lower(), (
            "Claim 1 should contain 'neural network'"
        )
E       AssertionError: Claim 1 should contain 'neural network'
E       assert 'neural network' in ', wherein the embedding is generated using a transformer model. 3. the method of claim 1, wherein the vector database uses cosine similarity. 4. a system comprising: a processor; and a memory containing instructions that when executed cause the processor to perform the method of claim'
E        +  where ', wherein the embedding is generated using a transformer model. 3. the method of claim 1, wherein the vector database uses cosine similarity. 4. a system comprising: a processor; and a memory containing instructions that when executed cause the processor to perform the method of claim' = <built-in method lower of str object at 0x0000024C521EC960>()
E        +    where <built-in method lower of str object at 0x0000024C521EC960> = ', wherein the embedding is generated using a transformer model. 3. The method of claim 1, wherein the vector database uses cosine similarity. 4. A system comprising: a processor; and a memory containing instructions that when executed cause the processor to perform the method of claim'.lower
E        +      where ', wherein the embedding is generated using a transformer model. 3. The method of claim 1, wherein the vector database uses cosine similarity. 4. A system comprising: a processor; and a memory containing instructions that when executed cause the processor to perform the method of claim' = ParsedClaim(claim_number=1, claim_text=', wherein the embedding is generated using a transformer model. 3. The method of claim 1, wherein the vector database uses cosine similarity. 4. A system comprising: a processor; and a memory containing instructions that when executed cause the processor to perform the method of claim', claim_type='dependent', parent_claim=1, rag_components=[], char_count=285, word_count=46).claim_text

tests\test_parser.py:196: AssertionError
_______ TestClaimParserLevel4Minimal.test_multiple_paragraphs_fallback ________

self = <test_parser.TestClaimParserLevel4Minimal object at 0x0000024C29FC9250>
parser = <preprocessor.ClaimParser object at 0x0000024C4CF46990>

        def test_multiple_paragraphs_fallback(self, parser):
            """
            Level 4: Multiple paragraphs treated as separate claims.
            """
            multi_para = """
    First paragraph describing the first aspect of the invention. This includes several technical details.
    
    Second paragraph describing another aspect. It references different technologies.
    
    Third paragraph with more details about implementation.
    """
            claims = parser.parse_claims_text(multi_para)
    
>           assert len(claims) >= 2, (
                f"Multiple paragraphs should produce multiple claims, got {len(claims)}"
            )
E           AssertionError: Multiple paragraphs should produce multiple claims, got 1
E           assert 1 >= 2
E            +  where 1 = len([ParsedClaim(claim_number=1, claim_text='First paragraph describing the first aspect of the invention. This includes several technical details. Second paragraph describing another aspect. It references different technologies. Third paragraph with more details about implementation.', claim_type='independent', parent_claim=None, rag_components=[], char_count=240, word_count=30)])

tests\test_parser.py:371: AssertionError
=========================== short test summary info ===========================
FAILED tests/test_parser.py::TestClaimParserLevel1Regex::test_standard_us_format_basic
FAILED tests/test_parser.py::TestClaimParserLevel1Regex::test_claim_numbering
FAILED tests/test_parser.py::TestClaimParserLevel1Regex::test_independent_vs_dependent_detection
FAILED tests/test_parser.py::TestClaimParserLevel1Regex::test_rag_component_detection
FAILED tests/test_parser.py::TestClaimParserLevel1Regex::test_claim_text_content
FAILED tests/test_parser.py::TestClaimParserLevel4Minimal::test_multiple_paragraphs_fallback
======================== 6 failed, 21 passed in 2.89s =========================
