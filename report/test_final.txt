============================= test session starts =============================
platform win32 -- Python 3.13.9, pytest-9.0.2, pluggy-1.5.0 -- C:\Users\Playdata\miniconda3\python.exe
cachedir: .pytest_cache
metadata: {'Python': '3.13.9', 'Platform': 'Windows-11-10.0.26100-SP0', 'Packages': {'pytest': '9.0.2', 'pluggy': '1.5.0'}, 'Plugins': {'anyio': '4.12.0', 'langsmith': '0.6.4', 'asyncio': '1.3.0', 'html': '4.2.0', 'metadata': '3.1.1'}, 'JAVA_HOME': 'C:\\Program Files\\Android\\Android Studio\\jbr'}
rootdir: C:\Workspaces\SKN22-3rd-2Team
plugins: anyio-4.12.0, langsmith-0.6.4, asyncio-1.3.0, html-4.2.0, metadata-3.1.1
asyncio: mode=Mode.STRICT, debug=False, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
collecting ... collected 27 items

tests/test_hybrid_search.py::TestHybridSearchRRF::test_cross_rank_verification_top_tier PASSED [  3%]
tests/test_hybrid_search.py::TestHybridSearchRRF::test_symmetric_weighting PASSED [  7%]
tests/test_hybrid_search.py::TestHybridSearchRRF::test_asymmetric_weighting_dense_heavy PASSED [ 11%]
tests/test_hybrid_search.py::TestHybridSearchRRF::test_asymmetric_weighting_sparse_heavy PASSED [ 14%]
tests/test_hybrid_search.py::TestHybridSearchRRF::test_edge_case_empty_dense_results PASSED [ 18%]
tests/test_hybrid_search.py::TestHybridSearchRRF::test_edge_case_empty_sparse_results PASSED [ 22%]
tests/test_hybrid_search.py::TestHybridSearchRRF::test_edge_case_both_empty PASSED [ 25%]
tests/test_hybrid_search.py::TestHybridSearchRRF::test_rrf_k_constant_effect PASSED [ 29%]
tests/test_parser.py::TestClaimParserLevel1Regex::test_standard_us_format_basic PASSED [ 33%]
tests/test_parser.py::TestClaimParserLevel1Regex::test_claim_numbering PASSED [ 37%]
tests/test_parser.py::TestClaimParserLevel1Regex::test_independent_vs_dependent_detection PASSED [ 40%]
tests/test_parser.py::TestClaimParserLevel1Regex::test_rag_component_detection PASSED [ 44%]
tests/test_parser.py::TestClaimParserLevel1Regex::test_claim_text_content PASSED [ 48%]
tests/test_parser.py::TestClaimParserLevel2Structure::test_bracket_numbered_format FAILED [ 51%]
tests/test_parser.py::TestClaimParserLevel2Structure::test_korean_format_parsing PASSED [ 55%]
tests/test_parser.py::TestClaimParserLevel2Structure::test_mixed_indent_structure PASSED [ 59%]
tests/test_parser.py::TestClaimParserLevel3NLP::test_ocr_noise_handling PASSED [ 62%]
tests/test_parser.py::TestClaimParserLevel3NLP::test_nlp_disabled_graceful_fallback PASSED [ 66%]
tests/test_parser.py::TestClaimParserLevel3NLP::test_sentence_boundary_mock PASSED [ 70%]
tests/test_parser.py::TestClaimParserLevel4Minimal::test_raw_text_blob_fallback PASSED [ 74%]
tests/test_parser.py::TestClaimParserLevel4Minimal::test_empty_input_handling PASSED [ 77%]
tests/test_parser.py::TestClaimParserLevel4Minimal::test_whitespace_only_input PASSED [ 81%]
tests/test_parser.py::TestClaimParserLevel4Minimal::test_single_paragraph_fallback PASSED [ 85%]
tests/test_parser.py::TestClaimParserLevel4Minimal::test_multiple_paragraphs_fallback FAILED [ 88%]
tests/test_parser.py::TestClaimParserDataIntegrity::test_parsed_claim_dataclass_fields PASSED [ 92%]
tests/test_parser.py::TestClaimParserDataIntegrity::test_char_and_word_counts PASSED [ 96%]
tests/test_parser.py::TestClaimParserDataIntegrity::test_claims_sorted_by_number PASSED [100%]

================================== FAILURES ===================================
_________ TestClaimParserLevel2Structure.test_bracket_numbered_format _________

self = <test_parser.TestClaimParserLevel2Structure object at 0x0000016B3EB36350>
parser = <preprocessor.ClaimParser object at 0x0000016B3EAA9130>
bracket_numbered_claims = '\n(1) A method for patent analysis comprising:\n    extracting claims from a patent document;\n    parsing the claims...laim 1, wherein the parsing uses NLP techniques.\n\n[3] A computer-readable medium storing instructions for claim 1.\n'

    def test_bracket_numbered_format(self, parser, bracket_numbered_claims):
        """
        Level 2 (Structure): Parse claims with bracket numbering (1), [1].
        """
        claims = parser.parse_claims_text(bracket_numbered_claims)
    
>       assert len(claims) >= 2, (
            f"Expected at least 2 claims from bracket format, got {len(claims)}"
        )
E       AssertionError: Expected at least 2 claims from bracket format, got 1
E       assert 1 >= 2
E        +  where 1 = len([ParsedClaim(claim_number=1, claim_text=', wherein the parsing uses NLP techniques. [3] A computer-readable medium storing instructions for claim', claim_type='independent', parent_claim=None, rag_components=[], char_count=104, word_count=15)])

tests\test_parser.py:213: AssertionError
_______ TestClaimParserLevel4Minimal.test_multiple_paragraphs_fallback ________

self = <test_parser.TestClaimParserLevel4Minimal object at 0x0000016B3EC855B0>
parser = <preprocessor.ClaimParser object at 0x0000016B61C96750>

    def test_multiple_paragraphs_fallback(self, parser):
        """
        Level 4: Multiple paragraphs treated as separate claims.
    
        Note: Paragraphs must be separated by double newlines and be > 15 chars.
        """
        # Use explicit string with clear paragraph separation
        multi_para = (
            "First paragraph describing the first aspect of the invention with details.\n\n"
            "Second paragraph describing another aspect with more technical details.\n\n"
            "Third paragraph with implementation details and additional information."
        )
        claims = parser.parse_claims_text(multi_para)
    
>       assert len(claims) >= 2, (
            f"Multiple paragraphs should produce multiple claims, got {len(claims)}"
        )
E       AssertionError: Multiple paragraphs should produce multiple claims, got 1
E       assert 1 >= 2
E        +  where 1 = len([ParsedClaim(claim_number=1, claim_text='First paragraph describing the first aspect of the invention with details. Second paragraph describing another aspect with more technical details. Third paragraph with implementation details and additional information.', claim_type='independent', parent_claim=None, rag_components=[], char_count=218, word_count=28)])

tests\test_parser.py:372: AssertionError
=========================== short test summary info ===========================
FAILED tests/test_parser.py::TestClaimParserLevel2Structure::test_bracket_numbered_format
FAILED tests/test_parser.py::TestClaimParserLevel4Minimal::test_multiple_paragraphs_fallback
======================== 2 failed, 25 passed in 2.79s =========================
